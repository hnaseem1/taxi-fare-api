
<div class="search-field">
  <%= form_tag(google_path, :method => "get" ) do %>
    <h2>Start location</h2>
    <p>
      <%= text_field_tag :start_location, params[:start_location], class: "input-field", id: "autocomplete", placeholder: "Enter your address", onFocus: "geolocate()", type:"text" %>
      <button type="button" name="button" id='get-location-data'>Get Location</button>
    </p>

    <h2>Destination</h2>
    <p>
      <%= text_field_tag :end_location, params[:end_location], class: "input-field", id: "autocomplete2", placeholder: "Enter your address", onFocus: "geolocate()", type:"text" %>
      <button type="button" name="button" id='get-location-data2'>Get Location</button>
    </p>

    <p><%= submit_tag "Run Baby, RUN!!!", class: "submit"%></p>

    <% if flash[:error] %>
      <p><%= flash[:error] %></p>
    <% end %>
  <% end %>
</div>

<div id="map" style="display: none"></div>

<script>

        var locationButton = document.getElementById('get-location-data')
        locationButton.addEventListener('click', function() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                myposition = position
               var pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
                };

              response = $.ajax({
                url: 'https://maps.googleapis.com/maps/api/geocode/json?latlng='+pos.lat+', '+pos.lng+'&key=AIzaSyDxHtxeT7TcaPqz8y2tPRWbqIwB9ROdZfk',
                method: 'GET',
                dataType: 'json'
              }).done(function(data) {
                document.getElementById('autocomplete').value = response.responseJSON.results[0].formatted_address
              })
            })
          }
        })

      var locationButton2 = document.getElementById('get-location-data2')
      locationButton2.addEventListener('click', function() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
              myposition = position
             var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            response = $.ajax({
              url: 'https://maps.googleapis.com/maps/api/geocode/json?latlng='+pos.lat+', '+pos.lng+'&key=AIzaSyDxHtxeT7TcaPqz8y2tPRWbqIwB9ROdZfk',
              method: 'GET',
              dataType: 'json'
            }).done(function(data) {
              document.getElementById('autocomplete2').value = response.responseJSON.results[0].formatted_address
            })
          })
        }
      })

        var autocomplete, autocomplete2;

        function initAutocomplete() {
          // Create the autocomplete object, restricting the search to geographical
          // location types.

          autocomplete2 = new google.maps.places.Autocomplete(
              /** @type {!HTMLInputElement} */(document.getElementById('autocomplete2')),
              {types: ['geocode']});

          autocomplete = new google.maps.places.Autocomplete(
              /** @type {!HTMLInputElement} */(document.getElementById('autocomplete')),
              {types: ['geocode']});
              initMap()

        }


        function initMap() {
                var directionsService = new google.maps.DirectionsService;
                var directionsDisplay = new google.maps.DirectionsRenderer;
                var map = new google.maps.Map(document.getElementById('map'), {
                  zoom: 9,
                  center: {lat: 43.7151, lng: -79.4362}
                });
                directionsDisplay.setMap(map);

                var onChangeHandler = function() {
                  calculateAndDisplayRoute(directionsService, directionsDisplay);

                };
                document.getElementById('autocomplete').addEventListener('change', onChangeHandler);
                document.getElementById('autocomplete2').addEventListener('change', onChangeHandler);
                onChangeHandler()
                document.getElementById('map').style.display = ''

              }

              function calculateAndDisplayRoute(directionsService, directionsDisplay) {
                directionsService.route({
                  origin: document.getElementById('autocomplete').value,
                  destination: document.getElementById('autocomplete2').value,
                  travelMode: 'DRIVING'
                }, function(response, status) {
                  if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                  }
                });
              }
      </script>

<% if @parsed_taxi_fare_response %>
  <div class="results">
    <% @parsed_taxi_fare_response[:uber].each do |option| %>
      <h3><%= checktype(option["type"])  %></h3>
      <p><%= option["fare"]  %>  <%= option["currency"] %></p>
      <p>Travel time: <%= option["duration"]/60 %> minutes</p>
    <% end %>
    <% @parsed_taxi_fare_response[:lyft].each do |option| %>
      <h3><%= option["type"]  %></h3>
      <p><%= option["fare"]  %>  <%= option["currency"] %></p>
      <p>Travel time: <%= option["duration"]/60 %> minutes</p>
    <% end %>
  </div>

  <button type="button" name="button">Show destination</button>

<% end %>

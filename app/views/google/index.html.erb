<style media="screen">
#map {
        height: 50%;
        width: 70%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
</style>



<p>Gustavo Karen Hasan Shashike</p>

  <div class="search-field">
  <%= form_tag(google_path, :method => "get" ) do %>
<h2>Start location</h2>
  <%= text_field_tag :start_location, params[:start_location], id: "autocomplete", placeholder: "Enter your address", type:"text" %>
  <button type="button" name="button" id='get-location-data'>Get Location</button>
  <br>
  <h2>Destination</h2>
<%= text_field_tag :end_location, params[:end_location], id: "autocomplete2", placeholder: "Enter your address", type:"text" %>
<button type="button" name="button" id='get-location-data2'>Get Location</button>

<br>
<br>
  <%= submit_tag "Run Baby, RUN!!!" %>
  <% end %>

  <button type="button" id="showmap" name="button">show map</button>
</div>
<div id="map" style="display: none"></div>
  <script>

        var locationButton = document.getElementById('get-location-data')
        locationButton.addEventListener('click', function() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                myposition = position
               var pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
                };

              response = $.ajax({
                url: 'https://maps.googleapis.com/maps/api/geocode/json?latlng='+pos.lat+', '+pos.lng+'&key=AIzaSyDxHtxeT7TcaPqz8y2tPRWbqIwB9ROdZfk',
                method: 'GET',
                dataType: 'json'
              }).done(function(data) {
                document.getElementById('autocomplete').value = response.responseJSON.results[0].formatted_address
              })
            })
          }
        })

      var locationButton2 = document.getElementById('get-location-data2')
      locationButton2.addEventListener('click', function() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
              myposition = position
             var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            response = $.ajax({
              url: 'https://maps.googleapis.com/maps/api/geocode/json?latlng='+pos.lat+', '+pos.lng+'&key=AIzaSyDxHtxeT7TcaPqz8y2tPRWbqIwB9ROdZfk',
              method: 'GET',
              dataType: 'json'
            }).done(function(data) {
              document.getElementById('autocomplete2').value = response.responseJSON.results[0].formatted_address
            })
          })
        }
      })

        var autocomplete, autocomplete2;

        function initAutocomplete() {
          // Create the autocomplete object, restricting the search to geographical
          // location types.

          autocomplete2 = new google.maps.places.Autocomplete(
              /** @type {!HTMLInputElement} */(document.getElementById('autocomplete2')),
              {types: ['geocode']});

          autocomplete = new google.maps.places.Autocomplete(
              /** @type {!HTMLInputElement} */(document.getElementById('autocomplete')),
              {types: ['geocode']});
        }


        function initMap() {
                var directionsService = new google.maps.DirectionsService;
                var directionsDisplay = new google.maps.DirectionsRenderer;
                var map = new google.maps.Map(document.getElementById('map'), {
                  zoom: 7,
                  center: {lat: 41.85, lng: -87.65}
                });
                directionsDisplay.setMap(map);

                var onChangeHandler = function() {
                  calculateAndDisplayRoute(directionsService, directionsDisplay);

                };
                document.getElementById('autocomplete').addEventListener('change', onChangeHandler);
                document.getElementById('autocomplete2').addEventListener('change', onChangeHandler);
                onChangeHandler()
                document.getElementById('map').style.display = ''

              }

              function calculateAndDisplayRoute(directionsService, directionsDisplay) {
                directionsService.route({
                  origin: document.getElementById('autocomplete').value,
                  destination: document.getElementById('autocomplete2').value,
                  travelMode: 'DRIVING'
                }, function(response, status) {
                  if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                  } else {
                    window.alert('Directions request failed due to ' + status);
                  }
                });
              }
            var showmap = document.getElementById('showmap');
            showmap.addEventListener('click', function () {
              initMap()
            });
      </script>




<% if @parsed_taxi_fare_response %>
<br>
<% @parsed_taxi_fare_response[:uber].each do |option| %>
<%= checktype(option["type"])  %> : <%= option["fare"]  %>  <%= option["currency"] %>
<br>
<br>

<%= option["duration"]/60 %> Mins Journey
<br>
<br>
<% end %>

<% @parsed_taxi_fare_response[:lyft].each do |option| %>
<%= option["type"]  %> : <%= option["fare"]  %>  <%= option["currency"] %>
<br>
<%= option["duration"]/60 %> Mins Journey
<br>
<br>
<% end %>
<% end %>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDxHtxeT7TcaPqz8y2tPRWbqIwB9ROdZfk&libraries=places&callback=initAutocomplete"
    async defer></script>
